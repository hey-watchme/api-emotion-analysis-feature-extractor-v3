version: '3.8'

services:
  emotion-analysis-feature-extractor:
    image: 754724220380.dkr.ecr.ap-southeast-2.amazonaws.com/watchme-emotion-analysis-feature-extractor:latest
    container_name: emotion-analysis-feature-extractor
    ports:
      - "127.0.0.1:8018:8018"
    environment:
      # Hume API
      - HUME_API_KEY=${HUME_API_KEY}
      - HUME_SECRET_KEY=${HUME_SECRET_KEY}
      - HUME_POLL_INTERVAL=${HUME_POLL_INTERVAL:-3}
      - HUME_MAX_POLL_ATTEMPTS=${HUME_MAX_POLL_ATTEMPTS:-40}
      - HUME_CONFIDENCE_THRESHOLD=${HUME_CONFIDENCE_THRESHOLD:-0.5}

      # AWS
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_REGION=${AWS_REGION:-ap-southeast-2}
      - S3_BUCKET_NAME=${S3_BUCKET_NAME:-watchme-vault}

      # SQS
      - FEATURE_COMPLETED_QUEUE_URL=${FEATURE_COMPLETED_QUEUE_URL}

      # Supabase
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_KEY=${SUPABASE_KEY}

      # API
      - API_PORT=8018
    networks:
      - watchme-network
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8018/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  watchme-network:
    external: true